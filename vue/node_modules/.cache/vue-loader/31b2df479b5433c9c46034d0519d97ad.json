{"remainingRequest":"/home/centos/rails_v5.2.3/ChatC3/chat-c3/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/centos/rails_v5.2.3/ChatC3/chat-c3/src/components/Login.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/centos/rails_v5.2.3/ChatC3/chat-c3/src/components/Login.vue","mtime":1584370273494},{"path":"/home/centos/rails_v5.2.3/ChatC3/chat-c3/node_modules/vuetify-loader/lib/loader.js","mtime":1564062719000},{"path":"/home/centos/rails_v5.2.3/ChatC3/chat-c3/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/centos/rails_v5.2.3/ChatC3/chat-c3/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport Vue from 'vue'\r\nimport Axios from 'axios'\r\nimport VueAxios from 'vue-axios'\r\n\r\nconst axios = Axios\r\nVue.prototype.$axios = axios\r\n\r\nVue.use(VueAxios, Axios)\r\n\r\nexport default {\r\n  name: 'login',\r\n  data () {\r\n    return {\r\n      user_id: 'takana3333',\r\n      password: 'takana3333',\r\n      showPassword: false,\r\n      rules: {\r\n        required: v => !!v || '必須入力です',\r\n        passwordLength: v => (v.length <= 16 && v.length >= 8) || 'パスワードは8～16文字の間です',\r\n        userIdLength: v => (v.length <= 16 && v.length >= 8) || 'ユーザーIDは8～16文字の間です',\r\n        isHalfWidth: v => this.isHalfWidth(v) || '使用できるのは半角英数字のみです',\r\n      },\r\n      user_info: {\r\n        user_id: this.user_id,\r\n        password: this.password,\r\n      },\r\n      guest_info: {\r\n        user_id: '',\r\n        name: 'ゲスト',\r\n        image_name: \"/user/default.png\",\r\n        password: '',\r\n      },\r\n      alert_data: {\r\n        message: '',\r\n        type: null,\r\n      },\r\n    }\r\n  },\r\n  mounted(){\r\n    this.updateUserInfo()\r\n  },\r\n  methods: {\r\n    isHalfWidth(str) {\r\n      str = (str==null)? \"\":str\r\n      if(str.match(/^[A-Za-z0-9]*$/)){\r\n        return true\r\n      }else{\r\n        return false\r\n      }\r\n    },\r\n    loginUser(){\r\n      console.log(this.$refs.form)\r\n      if(this.$refs.form.validate()){\r\n        this.updateUserInfo()\r\n\r\n        this.$store.dispatch('auth/login', this.user_info)\r\n        .then(response => this.loginSuccessful(response))\r\n        .catch(error => this.loginFailed(error))\r\n      }\r\n    },\r\n    loginGuest(){\r\n      let formData = new FormData()\r\n      let date_str = this.getDateString()\r\n\r\n      fetch(this.guest_info.image_name)\r\n      .then(response => response.blob())\r\n      .then(blob => new File([blob], \"default.jpg\"))\r\n      .then(file => {\r\n        this.guest_info.user_id = date_str\r\n        this.guest_info.password = date_str\r\n\r\n        formData.append(\"user_id\", this.guest_info.user_id)\r\n        formData.append(\"name\", this.guest_info.name)\r\n        formData.append(\"image_name\", file)\r\n        formData.append(\"password\", this.guest_info.password)\r\n\r\n        this.$store.dispatch('auth/create', formData)\r\n        .then(response => {\r\n          this.$store.dispatch('auth/login', this.guest_info)\r\n          .then(response => this.loginSuccessful(response))\r\n          .catch(error => this.loginFailed(error))\r\n        })\r\n        .catch(error => {\r\n          this.loginFailed(error)\r\n        })\r\n\r\n      })\r\n    },\r\n    updateUserInfo(){\r\n      this.user_info.user_id = this.user_id\r\n      this.user_info.password = this.password\r\n    },\r\n    showAlert(message, type){\r\n      this.alert_data.message = message\r\n      this.alert_data.type = type\r\n    },\r\n    loginSuccessful(response){\r\n      this.showAlert('ログイン成功', 'success')\r\n      if(this.$store.getters['auth/isLogin'] === true){\r\n        this.$router.push('/startchat')\r\n      }\r\n    },\r\n    loginFailed(error){\r\n      this.showAlert(error.response.data, 'error')\r\n    },\r\n    getDateString(){\r\n      let date = new Date()\r\n      let yyyy = date.getFullYear()\r\n      let mm = this.toDoubleDigits(date.getMonth() + 1)\r\n      let dd = this.toDoubleDigits(date.getDate())\r\n      let hh = this.toDoubleDigits(date.getHours())\r\n      let mi = this.toDoubleDigits(date.getMinutes())\r\n      let ss = this.toDoubleDigits(date.getSeconds())\r\n      let ms = this.toDoubleDigits(date.getMilliseconds(2))\r\n\r\n      return \"\" + yyyy + mm + dd + hh + mi + ss + ms\r\n    },\r\n    toDoubleDigits(num){\r\n      num += \"\"\r\n\r\n      if(num.length === 1){\r\n        num = \"0\" + num\r\n      }else if(num.length > 2){\r\n        num = num.substr(1, 2)\r\n      }\r\n      return num\r\n    }\r\n  },\r\n}\r\n",{"version":3,"sources":["Login.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmDA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Login.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <v-content>\r\n    <v-container fluid id=\"container\">\r\n      <v-row no-gutters id=\"row\">\r\n        <v-card width=\"600\" class=\"mx-auto mb-auto\" color=\"green lighten-5\">\r\n          <v-card-title>ログイン</v-card-title>\r\n          <v-alert :color=\"alert_data.type\" v-if=\"alert_data.type\">\r\n              {{ alert_data.message }}\r\n          </v-alert>\r\n          <v-form class=\"signup_form ml-10 mb-10\" ref=\"form\">\r\n            <v-text-field\r\n              v-model=\"user_id\"\r\n              label=\"*ユーザーID 半角英数字 8～16文字\"\r\n              :rules=\"[rules.required, rules.userIdLength, rules.isHalfWidth]\"\r\n            ></v-text-field>\r\n            <v-text-field\r\n              v-model=\"password\"\r\n              :type=\"showPassword ? 'text' : 'password'\"\r\n              label=\"*パスワード 半角英数字 8～16文字\"\r\n              :append-icon=\"showPassword ? 'mdi-eye' : 'mdi-eye-off'\"\r\n              :rules=\"[rules.required, rules.passwordLength, rules.isHalfWidth]\"\r\n              @click:append=\"showPassword = !showPassword\"\r\n            ></v-text-field>\r\n            <div class=\"login_buttons\">\r\n              <div class=\"login_button\">\r\n                <v-btn\r\n                  class=\"mt-5\"\r\n                  color=\"teal lighten-4\"\r\n                  @click=\"loginUser\"\r\n                >\r\n                  ログイン\r\n                </v-btn>\r\n              </div>\r\n              <div class=\"guest_button\">\r\n                <v-btn\r\n                  class=\"mt-5 guest_button\"\r\n                  color=\"teal lighten-4\"\r\n                  @click=\"loginGuest\"\r\n                >\r\n                  ゲストログイン\r\n                </v-btn>\r\n              </div>\r\n            </div>\r\n          </v-form>\r\n        </v-card>\r\n      </v-row>\r\n    </v-container>\r\n  </v-content>\r\n</template>\r\n\r\n<script>\r\nimport Vue from 'vue'\r\nimport Axios from 'axios'\r\nimport VueAxios from 'vue-axios'\r\n\r\nconst axios = Axios\r\nVue.prototype.$axios = axios\r\n\r\nVue.use(VueAxios, Axios)\r\n\r\nexport default {\r\n  name: 'login',\r\n  data () {\r\n    return {\r\n      user_id: 'takana3333',\r\n      password: 'takana3333',\r\n      showPassword: false,\r\n      rules: {\r\n        required: v => !!v || '必須入力です',\r\n        passwordLength: v => (v.length <= 16 && v.length >= 8) || 'パスワードは8～16文字の間です',\r\n        userIdLength: v => (v.length <= 16 && v.length >= 8) || 'ユーザーIDは8～16文字の間です',\r\n        isHalfWidth: v => this.isHalfWidth(v) || '使用できるのは半角英数字のみです',\r\n      },\r\n      user_info: {\r\n        user_id: this.user_id,\r\n        password: this.password,\r\n      },\r\n      guest_info: {\r\n        user_id: '',\r\n        name: 'ゲスト',\r\n        image_name: \"/user/default.png\",\r\n        password: '',\r\n      },\r\n      alert_data: {\r\n        message: '',\r\n        type: null,\r\n      },\r\n    }\r\n  },\r\n  mounted(){\r\n    this.updateUserInfo()\r\n  },\r\n  methods: {\r\n    isHalfWidth(str) {\r\n      str = (str==null)? \"\":str\r\n      if(str.match(/^[A-Za-z0-9]*$/)){\r\n        return true\r\n      }else{\r\n        return false\r\n      }\r\n    },\r\n    loginUser(){\r\n      console.log(this.$refs.form)\r\n      if(this.$refs.form.validate()){\r\n        this.updateUserInfo()\r\n\r\n        this.$store.dispatch('auth/login', this.user_info)\r\n        .then(response => this.loginSuccessful(response))\r\n        .catch(error => this.loginFailed(error))\r\n      }\r\n    },\r\n    loginGuest(){\r\n      let formData = new FormData()\r\n      let date_str = this.getDateString()\r\n\r\n      fetch(this.guest_info.image_name)\r\n      .then(response => response.blob())\r\n      .then(blob => new File([blob], \"default.jpg\"))\r\n      .then(file => {\r\n        this.guest_info.user_id = date_str\r\n        this.guest_info.password = date_str\r\n\r\n        formData.append(\"user_id\", this.guest_info.user_id)\r\n        formData.append(\"name\", this.guest_info.name)\r\n        formData.append(\"image_name\", file)\r\n        formData.append(\"password\", this.guest_info.password)\r\n\r\n        this.$store.dispatch('auth/create', formData)\r\n        .then(response => {\r\n          this.$store.dispatch('auth/login', this.guest_info)\r\n          .then(response => this.loginSuccessful(response))\r\n          .catch(error => this.loginFailed(error))\r\n        })\r\n        .catch(error => {\r\n          this.loginFailed(error)\r\n        })\r\n\r\n      })\r\n    },\r\n    updateUserInfo(){\r\n      this.user_info.user_id = this.user_id\r\n      this.user_info.password = this.password\r\n    },\r\n    showAlert(message, type){\r\n      this.alert_data.message = message\r\n      this.alert_data.type = type\r\n    },\r\n    loginSuccessful(response){\r\n      this.showAlert('ログイン成功', 'success')\r\n      if(this.$store.getters['auth/isLogin'] === true){\r\n        this.$router.push('/startchat')\r\n      }\r\n    },\r\n    loginFailed(error){\r\n      this.showAlert(error.response.data, 'error')\r\n    },\r\n    getDateString(){\r\n      let date = new Date()\r\n      let yyyy = date.getFullYear()\r\n      let mm = this.toDoubleDigits(date.getMonth() + 1)\r\n      let dd = this.toDoubleDigits(date.getDate())\r\n      let hh = this.toDoubleDigits(date.getHours())\r\n      let mi = this.toDoubleDigits(date.getMinutes())\r\n      let ss = this.toDoubleDigits(date.getSeconds())\r\n      let ms = this.toDoubleDigits(date.getMilliseconds(2))\r\n\r\n      return \"\" + yyyy + mm + dd + hh + mi + ss + ms\r\n    },\r\n    toDoubleDigits(num){\r\n      num += \"\"\r\n\r\n      if(num.length === 1){\r\n        num = \"0\" + num\r\n      }else if(num.length > 2){\r\n        num = num.substr(1, 2)\r\n      }\r\n      return num\r\n    }\r\n  },\r\n}\r\n</script>\r\n\r\n<style>\r\n#container {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n#row {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n#col {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n.signup_form{\r\n  width: 400px;\r\n}\r\n.login_buttons{\r\n  display: flex;\r\n}\r\n.guest_button{\r\n  margin: 0 0 0 auto;\r\n}\r\n</style>\r\n"]}]}